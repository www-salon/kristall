// Translation map
const translations = {
    en: {
        title: "Crystal Men's Salon | Premium Barber in Berlin",
        meta: {
            description: "Crystal Men's Salon - Premium barber shop in Berlin. Master craftsmanship, luxurious ambiance, and individual consultation."
        },
        nav: {
            subtitle: "SALON FOR GENTLEMEN",
            home: "Home",
            about: "About Us",
            services: "Services",
            gallery: "Gallery",
            contact: "Contact"
        },
        hero: {
            title: "MASTER<span class='highlight'>CRAFT</span><br>IN A LUXURY<span class='highlight'>AMBIENCE</span>",
            subtitle: "Where tradition meets modern elegance",
            cta: "Book Appointment"
        },
        about: {
            title: "ABOUT US",
            intro: "Welcome to the <span class='highlight-text'>Kristall Men's Salon</span>, where precision meets perfection.",
            description1: "For over a decade, we have been the first address for discerning gentlemen in Berlin who value craftsmanship, exclusive products, and an unforgettable experience.",
            description2: "Our master barbers combine traditional barber techniques with state-of-the-art styling methods to create the perfect look for every guest.",
            feature1: {
                title: "Master Craftsmanship",
                description: "Annual training for our barbers"
            },
            feature2: {
                title: "Luxury Ambiance",
                description: "Exclusive interior with maximum comfort"
            },
            feature3: {
                title: "Premium Products",
                description: "Only selected brands for best results"
            }
        },
        services: {
            title: "OUR SERVICES",
            subtitle: "Transparent prices for first-class services",
            haircut: {
                title: "Haircut",
                description: "Professional men's haircut with consultation, hair wash, and styling"
            },
            kids: {
                title: "Kids' Haircuts",
                description: "Special haircut for children up to 10 years in child-friendly atmosphere"
            },
            beardShave: {
                title: "Beard Shave",
                description: "Complete beard shave with shaving cream, warm towels, and after-shave care"
            },
            beardTrim: {
                title: "Beard Trim",
                description: "Beard trimming, shaping, and oil care for a well-groomed look"
            },
            faceMask: {
                title: "Face Mask",
                description: "Nourishing facial mask for cleansing, revitalization, and skin tightening"
            },
            eyebrows: {
                title: "Eyebrows",
                description: "Precise eyebrow threading with traditional thread technique"
            },
            waxing: {
                title: "Waxing",
                description: "Hair removal with wax for small areas like nose or ears"
            },
            wash: {
                title: "Wash",
                description: "Hair wash with premium shampoo and head massage"
            },
            dryStyling: {
                title: "Dry Styling",
                description: "Professional dry blow-drying and hair styling"
            },
            complete: {
                title: "Complete Service",
                description: "Wash · Cut · Beard Shave · Facial Hair Removal (Wax or Thread)"
            },
            fullFace: {
                title: "Full Face Hair Removal",
                description: "Complete facial hair removal (wax or thread) for flawless skin"
            },
            consultation: {
                title: "Free Consultation",
                description: "Personal style consultation without obligation. Together we'll find your perfect look."
            }
        },
        gallery: {
            title: "GALLERY",
            overlay: {
                title: "Our Salon Ambiance",
                description: "Luxurious interior with maximum comfort"
            }
        },
        contact: {
            title: "CONTACT & LOCATION",
            address: {
                title: "Address",
                details: "Urbanstraße 37<br>10967 Berlin<br>Germany"
            },
            phone: {
                title: "Phone",
                note: "Telephone appointment booking"
            },
            hours: {
                title: "Opening Hours",
                weekdays: "Monday - Friday:",
                saturday: "Saturday:",
                sunday: "Sunday:",
                closed: "Closed"
            },
            appointment: {
                title: "Appointment Booking",
                description: "We value personal consultation. Please book your appointment by phone during our opening hours."
            }
        },
        footer: {
            subtitle: "SALON FOR GENTLEMEN",
            copyright: "© 2026 Crystal Men's Salon. All rights reserved."
        }
    },
    de: {
        title: "Kristall Salon für Herren | Premium Barber in Berlin",
        meta: {
            description: "Kristall Salon für Herren - Premium Herrenfriseur in Berlin. Meisterhandwerk, luxuriöses Ambiente und individuelle Beratung."
        },
        nav: {
            subtitle: "SALON FÜR HERREN",
            home: "Start",
            about: "Über Uns",
            services: "Leistungen",
            gallery: "Galerie",
            contact: "Kontakt"
        },
        hero: {
            title: "MEISTER<span class='highlight'>HANDWERK</span><br>IN EINEM LUXUS<span class='highlight'>AMBIENTE</span>",
            subtitle: "Wo Tradition auf moderne Eleganz trifft",
            cta: "Termin vereinbaren"
        },
        about: {
            title: "ÜBER UNS",
            intro: "Willkommen im <span class='highlight-text'>Kristall Salon für Herren</span>, wo Präzision auf Perfektion trifft.",
            description1: "Seit über einem Jahrzehnt sind wir die erste Adresse für anspruchsvolle Herren in Berlin, die Wert auf Handwerkskunst, exklusive Produkte und ein unvergessliches Erlebnis legen.",
            description2: "Unsere Meisterfriseure verbinden traditionelle Barber-Techniken mit modernsten Styling-Methoden, um für jeden Gast den perfekten Look zu kreieren.",
            feature1: {
                title: "Meisterhandwerk",
                description: "Jährliche Weiterbildung unserer Friseure"
            },
            feature2: {
                title: "Luxusambiente",
                description: "Exklusives Interior mit höchstem Komfort"
            },
            feature3: {
                title: "Premium Produkte",
                description: "Nur ausgewählte Marken für beste Ergebnisse"
            }
        },
        services: {
            title: "UNSERE LEISTUNGEN",
            subtitle: "Transparente Preise für erstklassige Dienstleistungen",
            haircut: {
                title: "Haarschnitt",
                description: "Professioneller Herrenhaarschnitt mit Beratung, Haarwäsche und Styling"
            },
            kids: {
                title: "Kinderfrisuren",
                description: "Spezieller Haarschnitt für Kinder bis 10 Jahre in kindgerechter Atmosphäre"
            },
            beardShave: {
                title: "Bart Rasur",
                description: "Komplette Bartrasur mit Rasiercreme, warmen Tüchern und After-Shave-Pflege"
            },
            beardTrim: {
                title: "Bart Schneiden",
                description: "Bart trimmen, in Form schneiden und mit Öl pflegen für gepflegte Optik"
            },
            faceMask: {
                title: "Maske für Gesicht",
                description: "Pflegende Gesichtsmaske zur Reinigung, Revitalisierung und Hautstraffung"
            },
            eyebrows: {
                title: "Augenbrauen",
                description: "Präzises Augenbrauen zupfen mit traditioneller Fadentechnik"
            },
            waxing: {
                title: "Wachs",
                description: "Haarentfernung mit Wachs für kleine Bereiche wie Nase oder Ohren"
            },
            wash: {
                title: "Waschen",
                description: "Haare waschen mit Premium-Shampoo und Kopfmassage"
            },
            dryStyling: {
                title: "Trocken Föhnen",
                description: "Professionelles Trockenföhnen und Styling der Haare"
            },
            complete: {
                title: "Komplett-Service",
                description: "Waschen · Schneiden · Bartrasieren · Gesichtshaarentfernung (Wachs oder Faden)"
            },
            fullFace: {
                title: "Gesichtshaarentfernung",
                description: "Komplette Gesichtshaarentfernung (Wachs oder Faden) für makellose Haut"
            },
            consultation: {
                title: "Kostenlose Beratung",
                description: "Persönliche Stilberatung ohne Verpflichtung. Gemeinsam finden wir Ihren perfekten Look."
            }
        },
        gallery: {
            title: "GALERIE",
            overlay: {
                title: "Unser Salon Ambiente",
                description: "Luxuriöses Interior mit höchstem Komfort"
            }
        },
        contact: {
            title: "KONTAKT & ANFAHRT",
            address: {
                title: "Adresse",
                details: "Urbanstraße 37<br>10967 Berlin<br>Deutschland"
            },
            phone: {
                title: "Telefon",
                note: "Telefonische Terminvereinbarung"
            },
            hours: {
                title: "Öffnungszeiten",
                weekdays: "Montag - Freitag:",
                saturday: "Samstag:",
                sunday: "Sonntag:",
                closed: "Geschlossen"
            },
            appointment: {
                title: "Terminvereinbarung",
                description: "Wir legen Wert auf persönliche Beratung. Bitte vereinbaren Sie Ihren Termin telefonisch während unserer Öffnungszeiten."
            }
        },
        footer: {
            subtitle: "SALON FÜR HERREN",
            copyright: "© 2026 Kristall Salon für Herren. Alle Rechte vorbehalten."
        }
    },
    ar: {
        title: "صالون كريستال للرجال | حلاق ممتاز في برلين",
        meta: {
            description: "صالون كريستال للرجال - صالون حلاقة ممتاز في برلين. حرفية متقنة، أجواء فاخرة، واستشارة فردية."
        },
        nav: {
            subtitle: "صالون للرجال",
            home: "الرئيسية",
            about: "من نحن",
            services: "الخدمات",
            gallery: "معرض الصور",
            contact: "اتصل بنا"
        },
        hero: {
            title: "إتقان<span class='highlight'>الحرفية</span><br>في أجواء<span class='highlight'>فاخرة</span>",
            subtitle: "حيث يلتقي التقليد بالأناقة الحديثة",
            cta: "حجز موعد"
        },
        about: {
            title: "من نحن",
            intro: "مرحبًا بكم في <span class='highlight-text'>صالون كريستال للرجال</span>، حيث تلتقي الدقة بالكمال.",
            description1: "لأكثر من عقد من الزمان، كنا العنوان الأول للرجال المميزين في برلين الذين يقدرون الحرفية والمنتجات الحصرية والتجربة التي لا تنسى.",
            description2: "يجمع حلاقونا الماهرون بين تقنيات الحلاقة التقليدية وأحدث أساليب التصفيف لخلق المظهر المثالي لكل ضيف.",
            feature1: {
                title: "إتقان الحرفية",
                description: "تدريب سنوي لحلاقينا"
            },
            feature2: {
                title: "أجواء فاخرة",
                description: "ديكور داخلي حصري بأقصى درجات الراحة"
            },
            feature3: {
                title: "منتجات مميزة",
                description: "فقط العلامات التجارية المختارة لأفضل النتائج"
            }
        },
        services: {
            title: "خدماتنا",
            subtitle: "أسعار شفافة لخدمات من الدرجة الأولى",
            haircut: {
                title: "قص الشعر",
                description: "قص شعر رجالي محترف مع استشارة، غسل الشعر، وتصفيف"
            },
            kids: {
                title: "قصات الأطفال",
                description: "قص شعر خاص للأطفال حتى 10 سنوات في أجواء مناسبة للأطفال"
            },
            beardShave: {
                title: "حلاقة اللحية",
                description: "حلاقة كاملة للحية مع كريم الحلاقة، مناديل دافئة، وعناية ما بعد الحلاقة"
            },
            beardTrim: {
                title: "تشذيب اللحية",
                description: "تشذيب وتشكيل اللحية والعناية بالزيت لمظهر أنيق"
            },
            faceMask: {
                title: "قناع الوجه",
                description: "قناع وجه مغذي للتنظيف، التجديد، وتنقية البشرة"
            },
            eyebrows: {
                title: "الحواجب",
                description: "تشذيب دقيق للحواجب بتقنية الخيط التقليدية"
            },
            waxing: {
                title: "إزالة الشعر بالشمع",
                description: "إزالة الشعر بالشمع للمناطق الصغيرة مثل الأنف أو الأذنين"
            },
            wash: {
                title: "غسل الشعر",
                description: "غسل الشعر بشامبو ممتاز وتدليك للرأس"
            },
            dryStyling: {
                title: "تصفيف جاف",
                description: "تجفيف وتصفيف محترف للشعر"
            },
            complete: {
                title: "خدمة كاملة",
                description: "غسل · قص · حلاقة اللحية · إزالة شعر الوجه (شمع أو خيط)"
            },
            fullFace: {
                title: "إزالة شعر الوجه الكاملة",
                description: "إزالة شعر الوجه الكاملة (شمع أو خيط) لبشرة خالية من العيوب"
            },
            consultation: {
                title: "استشارة مجانية",
                description: "استشارة أسلوب شخصية دون التزام. معًا سنجد مظهرك المثالي."
            }
        },
        gallery: {
            title: "معرض الصور",
            overlay: {
                title: "أجواء صالوننا",
                description: "ديكور داخلي فاخر بأقصى درجات الراحة"
            }
        },
        contact: {
            title: "اتصل بنا والموقع",
            address: {
                title: "العنوان",
                details: "Urbanstraße 37<br>10967 برلين<br>ألمانيا"
            },
            phone: {
                title: "الهاتف",
                note: "حجز موعد هاتفي"
            },
            hours: {
                title: "ساعات العمل",
                weekdays: "الاثنين - الجمعة:",
                saturday: "السبت:",
                sunday: "الأحد:",
                closed: "مغلق"
            },
            appointment: {
                title: "حجز موعد",
                description: "نحن نقدر الاستشارة الشخصية. يرجى حجز موعدك هاتفيًا خلال ساعات عملنا."
            }
        },
        footer: {
            subtitle: "صالون للرجال",
            copyright: "جميع الحقوق محفوظة لصالون كريستال للرجال © 2026"
        }
    }
};

// Function to update content based on language
function updateContent(lang) {
    // Validate language
    if (!translations[lang]) {
        console.warn(`Invalid language: ${lang}. Defaulting to 'en'.`);
        lang = 'en';
    }

    console.log(`Updating content to language: ${lang}`);
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

    document.title = translations[lang]?.title || "Crystal Men's Salon | Premium Barber in Berlin";

    // Update meta description
    const metaDescription = document.querySelector('meta[name="description"]');
    if (metaDescription && translations[lang]?.meta?.description) {
        metaDescription.content = translations[lang].meta.description;
    }

    // Update text content
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const keys = key.split('.');
        let value = translations[lang];
        
        for (const k of keys) {
            if (!value || typeof value !== 'object' || !(k in value)) {
                console.warn(`Translation missing for key: ${key} in language: ${lang}`);
                value = null;
                break;
            }
            value = value[k];
        }
        
        if (value && typeof value === 'string') {
            element.innerHTML = value;
        }
    });
}

// Function to get country code using geolocation API
async function getCountryCode() {
    try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        console.log(`Geolocation API returned country code: ${data.country_code}`);
        return data.country_code;
    } catch (error) {
        console.error('Error fetching geolocation:', error);
        return null;
    }
}

// Function to map country code to supported language
function getLanguageFromCountry(countryCode) {
    const countryLangMap = {
        // German-speaking countries
        'DE': 'de',      // Germany
        'AT': 'de',      // Austria
        'CH': 'de',      // Switzerland
        'LI': 'de',      // Liechtenstein
        'LU': 'de',      // Luxembourg
        'BE': 'de',      // Belgium (German-speaking community)
        
        // Arabic-speaking countries (Middle East)
        'SA': 'ar',      // Saudi Arabia
        'AE': 'ar',      // UAE
        'BH': 'ar',      // Bahrain
        'QA': 'ar',      // Qatar
        'KW': 'ar',      // Kuwait
        'OM': 'ar',      // Oman
        'YE': 'ar',      // Yemen
        'EG': 'ar',      // Egypt
        'JO': 'ar',      // Jordan
        'LB': 'ar',      // Lebanon
        'SY': 'ar',      // Syria
        'IQ': 'ar',      // Iraq
        'PS': 'ar',      // Palestine
        'MA': 'ar',      // Morocco
        'DZ': 'ar',      // Algeria
        'TN': 'ar',      // Tunisia
        'LY': 'ar',      // Libya
        'SD': 'ar',      // Sudan
        'SO': 'ar'       // Somalia
    };

    const lang = countryLangMap[countryCode] || 'en';
    console.log(`Country code: ${countryCode}, mapped to language: ${lang}`);
    return lang;
}

// Function to get URL parameters
function getUrlParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

// Function to get current language from URL, localStorage, or geolocation
async function getCurrentLanguage() {
    // First check URL parameter
    const urlLang = getUrlParameter('lang');
    if (urlLang && ['en', 'de', 'ar'].includes(urlLang)) {
        console.log(`Language from URL: ${urlLang}`);
        return urlLang;
    }
    
    // Then check localStorage
    const storedLang = localStorage.getItem('language');
    if (storedLang && ['en', 'de', 'ar'].includes(storedLang)) {
        console.log(`Language from localStorage: ${storedLang}`);
        return storedLang;
    }
    
    // Then use geolocation
    const countryCode = await getCountryCode();
    const geoLang = countryCode ? getLanguageFromCountry(countryCode) : 'en';
    console.log(`Language from geolocation: ${geoLang}`);
    return geoLang;
}

// Language switcher event listener
document.addEventListener('DOMContentLoaded', async () => {
    const languageSelect = document.getElementById('language-select');
    if (!languageSelect) {
        console.error('Language select element not found');
        return;
    }

    // Get current language
    const selectedLang = await getCurrentLanguage();

    // Set the language select value and update content
    console.log(`Setting language to: ${selectedLang}`);
    languageSelect.value = selectedLang;
    localStorage.setItem('language', selectedLang);
    updateContent(selectedLang);

    // Handle manual language selection
    languageSelect.addEventListener('change', (e) => {
        const lang = e.target.value;
        if (['en', 'de', 'ar'].includes(lang)) { 
            console.log(`Manual language selection: ${lang}`);
            localStorage.setItem('language', lang);
            updateContent(lang);
            
            // Update URL with language parameter without reloading
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('lang', lang);
            window.history.replaceState({}, '', newUrl);
        } else {
            console.warn(`Invalid language selected: ${lang}`);
        }
    });
});